<div class="row">
    <div class="col-md-12">
        <div class="bg-light">
            <h3>Plateformes de <strong>{{application.name}}</strong></h3>
            <list-of-items items="platforms"
                           label="$item.name"
                           sorton="$item.name"
                           selected-item="platform"
                           createfunction="add_platform($name)"
                           ondelete="delete_platform($item)"
                           onedit="on_edit_platform($item)"
                           selectable="true"
                           editable="false"
                           size="small">
            </list-of-items>
        </div>
    </div>
</div>
<div class="row" ng-show="platform">
    <div class="col-md-12">
        <div class="bg-light">

            <script type="text/ng-template" id="application/search_module.html">
                <div class="modal-header">
                    <h3 class="modal-title">Ajouter un module</h3>
                </div>
                <div class="modal-body">
                    <form name="searchModuleForm">
                        <label for="module">Module</label>
                        <input type="text" class="form-control" id="module"
                               ng-model="moduleSearched"
                               placeholder="Rechercher" required
                               typeahead-editable="false"
                               typeahead="module as module.title for module in find_modules_by_name($viewValue)"
                                />
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" ng-disabled="searchModuleForm.$invalid"
                            ng-click="$close(moduleSearched)" ng-hide="isReadOnly">Ok
                    </button>
                    <button class="btn btn-warning" ng-click="$dismiss('cancel')">Annuler</button>
                </div>
            </script>

            <script type="text/ng-template" id="application/add_box.html">
                <div class="modal-header">
                    <h3 class="modal-title">Ajouter un groupe logique</h3>
                </div>
                <div class="modal-body">
                    <form name="addComponentForm">
                        <label for="name">Nom</label>
                        <input type="text" class="form-control" id="name"
                               ng-model="new_component_name"
                               placeholder="Exemple WDIGST,..." required />
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" ng-disabled="addComponentForm.$invalid"
                            ng-click="$close(new_component_name)" ng-hide="isReadOnly">Ok
                    </button>
                    <button class="btn btn-warning" ng-click="$dismiss('cancel')">Annuler</button>
                </div>
            </script>

            <script type="text/ng-template" id="application/add_instance.html">
                <div class="modal-header">
                    <h3 class="modal-title">Ajouter une instance</h3>
                </div>
                <div class="modal-body">
                    <form name="addInstanceForm">
                        <label for="name">Nom</label>
                        <input type="text" class="form-control" id="name"
                               ng-model="new_instance_name" required />
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" ng-disabled="addInstanceForm.$invalid"
                            ng-click="$close(new_instance_name)" ng-hide="isReadOnly">Ok
                    </button>
                    <button class="btn btn-warning" ng-click="$dismiss('cancel')">Annuler</button>
                </div>
            </script>

            <script type="text/ng-template" id="box_renderer.html">
                <div id="header" style="height: 38px">
                    <div class="col-md-6 text-left" style="padding-left:10px">
                        <strong><a href="" editable-text="name"
                                   onbeforesave="update_box_name(box, name, $data)">{{name}}</a></strong>
                    </div>
                    <div class="col-md-6 text-right" style="padding-right:10px">
                        <button ng-click="search_module(box)" title="Ajouter un module"
                                class="btn btn-primary btn-xs">
                            <span class="glyphicon glyphicon-plus"></span>
                        </button>
                        <button ng-click="open_add_box_dialog(box)" title="Ajouter un groupe logique"
                                class="btn btn-success btn-xs">
                            <span class="glyphicon glyphicon-inbox"></span>
                        </button>
                        <button ng-click="remove_box(name, box)" ng-if="box.isEmpty()" title="Supprimer le groupe logique"
                                class="btn btn-danger btn-xs">
                            <span class="glyphicon glyphicon-trash"></span>
                        </button>
                    </div>
                </div>
                <ul class="list-inline">
                    <li class="box" ng-repeat="(name, box) in box.children"
                        ng-include="'box_renderer.html'"></li>
                    <li ng-if="box.modules.length > 0" class="box instance" ng-repeat="module in box.modules">
                        <div id="header" style="height: 38px; width: 100%">
                            <div class="col-md-6" style="padding-left:10px;white-space: nowrap;">
                                <span><strong>{{module.title}}</strong></span>
                            </div>
                            <div class="col-md-6 text-right" style="padding-right:10px">
                                <button ng-click="open_add_instance_dialog(module)" title="Ajouter une instance"
                                        class="btn btn-primary btn-xs">
                                    <span class="glyphicon glyphicon-plus"></span>
                                </button>
                                <button class="btn btn-info btn-xs" title="Editer les properties"
                                        ng-click="edit_properties(platform, module)"><span class="glyphicon glyphicon-list"></span>
                                </button>
                                <button ng-click="delete_module(module, box)" title="Supprimer le module"
                                        class="btn btn-danger btn-xs">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </button>
                            </div>
                        </div>
                        <div>
                            <ul class="list-inline" style="padding-top:10px; padding-bottom:10px">
                                <li ng-repeat="instance in module.instances">
                                    <button ng-click="edit_instance(instance)" title="Editer les properties de l'instance"
                                            class="btn btn-info btn-xs">
                                        <span class="glyphicon glyphicon-list" style="margin-right:10px"></span>{{instance.name}}
                                    </button>
                                    <button ng-click="delete_instance(instance, module)" title="Supprimer l'instance"
                                            class="btn btn-danger btn-xs">
                                        <span class="glyphicon glyphicon-trash"></span>
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </script>

            <h3><span style="margin-right: 30px">Representation logique de <strong>{{platform.name}}</strong></span>
                <button ng-click="open_add_box_dialog(mainBox)" class="btn btn-sm">
                    <span class="glyphicon glyphicon-plus" style="padding-right:10px"></span>
                    <span>Ajouter un groupe logique</span>
                </button>
                <button ng-click="save_platform_from_box(mainBox)" class="btn btn-sm">
                    <span class="glyphicon glyphicon-saved" style="padding-right:10px"></span>
                    <span>Sauver la plateforme</span>
                </button>
            </h3>
            <ul class="list-inline">
                <li class="box" ng-repeat="(name, box) in mainBox.children" ng-include="'box_renderer.html'"/>
                <li class="box" ng-if="box.modules.length > 0">
                    <button class="btn btn-info btn-sm" style="margin: 5px 5px 5px 5px"
                            ng-repeat="module in mainBox.modules">{{module.title}} <span
                            class="glyphicon glyphicon-list"></span></button>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="row" ng-show="properties">
    <div class="col-md-12">
        <div class="bg-light">
            <h3><span style="margin-right: 30px">Les properties associees a <strong>{{selected_module.path.split('#').join(' | ')}} | {{selected_module.title}}</strong></span>
                <button ng-click="save_properties(properties, selected_module)" class="btn btn-sm">
                    <span class="glyphicon glyphicon-saved" style="padding-right:10px"></span>
                    <span>Sauver les properties</span>
                </button>
            </h3>
            <properties-list properties="properties">
            </properties-list>
        </div>
    </div>
</div>
<div class="row" ng-show="instance">
    <div class="col-md-12">
        <div class="bg-light">
            <h3>
                <span style="margin-right: 30px">Les properties d'instance associees a <strong>{{instance.name}}</strong></span>
                <button ng-click="save_platform_from_box(mainBox)" class="btn btn-sm">
                    <span class="glyphicon glyphicon-saved" style="padding-right:10px"></span>
                    <span>Sauver les properties</span>
                </button>
            </h3>
            <form class="form-horizontal narrow" role="form">
                <div class="form-group" ng-class="{'property-not-used': !key_value_property.inModel}" ng-repeat="key_value_property in instance.key_values | orderBy:'name' track by $index">
                    <label for="input-{{ key_value_property.name }}" class="col-md-3 control-label">{{ key_value_property.name }}</label>
                    <div class="col-md-9">
                        <input id="input-{{ key_value_property.name }}" type="text" class="form-control" placeholder="{{key_value_property.comment}}" ng-model="key_value_property.value" tooltip="{{key_value_property.comment}}" tooltip-trigger="focus" tooltip-placement="right" />
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>