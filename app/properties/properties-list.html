<form class="form-horizontal narrow" role="form" editable-form>
    <div class="form-group">
        <div class="col-md-12">

            <toggle-deleted-properties key-value-properties="properties.key_value_properties" toggle="displayDeletedProperties"></toggle-deleted-properties>
            <toggle-unspecified-properties key-value-properties="properties.key_value_properties" display = "displayUnspecified"></toggle-unspecified-properties>
        </div>

        <!-- TODO ajout des boutons permettant l'ajout de properties iterables -->
        <!--<div class="col-md-12">
            <add-iterable-property
                    ng-repeat="iterable_property in properties.iterable_properties | orderBy:'name' track by $index"
                    class="btn btn-warn btn-raised">
                <span>{{ iterable_property.name }}</span>
                <span class="glyphicon" data-ng-class="{'glyphicon-sort-by-alphabet-alt': !properties.isReverseOrder(), 'glyphicon-sort-by-alphabet': properties.isReverseOrder()}" style="padding-left:10px"></span>
            </add-iterable-property>
        </div>-->

        <div class="col-md-12">
            <button id="sortModulePropertiesButton" ng-click="properties.switchOrder()"
                    class="btn btn-warn btn-raised">
                <span>Tri par nom de property</span>
                <span class="glyphicon"
                      data-ng-class="{'glyphicon-sort-by-alphabet-alt': !properties.isReverseOrder(), 'glyphicon-sort-by-alphabet': properties.isReverseOrder()}"
                      style="padding-left:10px"></span>
            </button>
        </div>
        <div class="col-md-4">
            <input class="form-control" placeholder="filtrer les properties par clé" ng-model="propertiesKeyFilter"/>
        </div>
        <div class="col-md-8">
            <input class="form-control"
                   placeholder="filtrer les properties par valeur (les valeurs modifiées ne seront filtrables que suite &agrave; une sauvegarde)"
                   ng-model="propertiesValueFilter"/>
        </div>
    </div>

    <div vs-repeat style="max-height: 450px; overflow: auto" id="list-of-properties">
        <div class="form-group" style="width: 100%" ng-class="{'property-not-used': !key_value_property.inModel}" ng-repeat="key_value_property in properties.key_value_properties | filterProperties:{'name':propertiesKeyFilter, 'filtrable_value':propertiesValueFilter} | displayProperties:displayDeletedProperties |  displayUnspecifiedProperties:displayUnspecified | orderBy:'name':properties.isReverseOrder() track by $index">
            <label style="text-align: right; overflow: hidden; text-overflow: ellipsis" title="{{ key_value_property.name }}" for="input-{{ key_value_property.name }}" class="col-md-4 control-label">{{ key_value_property.name }}</label> <span ng-show="key_value_property.required" style="color:red">*</span>
            <!-- Edit layout, and this key is not filled by global properties -->
            <div class="col-md-8" ng_if="!key_value_property.inGlobal">
                <input id="input-{{ key_value_property.name }}"
                   type="text" class="form-control default-value-color"
                   ng-class="{'property-using-global': key_value_property.useGlobal}"
                   placeholder="{{key_value_property.defaultValue ? '[default=' + key_value_property.defaultValue + '] ' : ''}}{{key_value_property.comment}}"
                   ng-model="key_value_property.value" tooltip="{{key_value_property.comment}}"
                   tooltip-trigger="focus"
                   ng-required="key_value_property.required"
                   tooltip-placement="top" />
            </div>
            <!-- Edit layout, but this key is filled by global properties -->
            <div class="col-md-8" ng_if="key_value_property.inGlobal">
                <label id="view-{{ key_value_property.name }}" class="control-label">{{key_value_property.value}}
                    <md-tooltip md-direction="right">
                        Valeur automatiquement valorisée <br/>par la variable globale du même nom.<br/>Pour la modifier,
                        changez son nom dans le template <br/>ou éditez la variable globale.
                    </md-tooltip>
                </label>
            </div>
        </div>
        <div class="form-group" style="width: 100%" ng-class="{'property-not-used': !iterable_property.inModel}"
             ng-repeat="iterable_property in properties.iterable_properties | filter:{'name':propertiesKeyFilter, 'filtrable_value':propertiesValueFilter} | displayProperties:displayDeletedProperties | orderBy:'name':properties.isReverseOrder() track by $index">
            <label style="text-align: right; overflow: hidden; text-overflow: ellipsis"
                   title="{{ iterable_property.name }}" for="input-{{ iterable_property.name }}"
                   class="col-md-4 control-label">{{ iterable_property.name }}</label> <span
                ng-show="key_value_property.required" style="color:red">*</span>
            <!-- Edit layout, and this key is not filled by global properties -->
            <div class="col-md-8" ng_if="!key_value_property.inGlobal">
                <input id="input-{{ iterable_property.name }}"
                       type="text" class="form-control"
                       ng-class="{'property-using-global': key_value_property.useGlobal}"
                       placeholder="{{key_value_property.defaultValue ? '[default=' + key_value_property.defaultValue + '] ' : ''}}{{key_value_property.comment}}"
                       ng-model="key_value_property.value" tooltip="{{key_value_property.comment}}"
                       tooltip-trigger="focus"
                       ng-required="key_value_property.required"
                       tooltip-placement="top"/>
            </div>
        </div>

        <script type="text/ng-template" id="properties/iterate.html">
            <li>{{ iterable_property.name }}<br/>
                <!-- Display each valorisation -->
                <div ng-repeat="items in iterable_property.iterable_valorisation_items | orderBy:'name' track by $index">
                    <div ng-repeat="field in items.values | orderBy:'name' track by $index">
                        {{field.iterable_properties}}
                        <ul class="dl-horizontal text-overflow" style="margin-bottom:0"
                            ng-if="field.iterable_valorisation_items"
                            ng-repeat="iterable_property in field.iterable_valorisation_items | orderBy:'name' track by $index"
                            ng-include="'properties/iterate2.html'">
                        </ul>

                        <div ng-if="!field.iterable_valorisation_items">
                            {{ field.name }}
                            <small style="padding-left: 10px;"><em>{{ field.comment }}</em></small>
                            {{ field.value }} / {{ field.inModel }}
                        </div>
                    </div>
                </div>
            </li>
        </script>

        <script type="text/ng-template" id="properties/iterate2.html">
            <li>{{ iterable_property.title }}<br/>
                <!-- Display each valorisation -->
                <div ng-repeat="field in iterable_property.values | orderBy:'name' track by $index">

                    {{field.iterable_properties}}
                    <ul class="dl-horizontal text-overflow" style="margin-bottom:0"
                        ng-if="field.iterable_valorisation_items"
                        ng-repeat="iterable_property in field.iterable_valorisation_items | orderBy:'name' track by $index"
                        ng-include="'properties/iterate2.html'">
                    </ul>

                    <div ng-if="!field.iterable_valorisation_items">
                        {{ field.name }}
                        <small style="padding-left: 10px;"><em>{{ field.comment }}</em></small>
                        {{ field.value }} / {{ field.inModel }}
                    </div>

                </div>
            </li>
        </script>

</form>