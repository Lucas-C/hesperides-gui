#!groovy

pipeline {
    agent {
        node {
            label 'default||master'
        }
    }
    triggers {
        cron('0 1,13 * * 1-5')
    }
    options {
        buildDiscarder(logRotator(numToKeepStr: '10'))
        disableConcurrentBuilds()
    }
    parameters {
        string(name: 'ELS_URL', defaultValue: 'http://elasticsearch-log-master-assemblage-lille-s1.socrate.vsct.fr:52300/')
        string(name: 'URL_HES', defaultValue: 'http://bogogno.socrate.vsct.fr:52700')
    }
    stages {
        stage("Pull Project") {
            steps {
                script {
                    git(url: 'git@gitlab.socrate.vsct.fr:hesperides/search_hesperides.git',
                        branch: 'master')
                }
            }
        }
        stage('Ex√©cution du batch') {
            steps {
                script {
                    sh "ELS_URL=${ELS_URL} URL_HES=${URL_HES} scripts/recup_hesperide2els.sh"
                }
            }
        }
    }
    post {
        always {
            deleteDir()
        }
    }
}
