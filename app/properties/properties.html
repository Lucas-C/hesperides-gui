<div layout="row">
    <div flex="100">
        <div class="bg-light">
            <h3>Plateformes de <strong>{{application.name}}</strong></h3>
            <list-of-items items="platforms"
                           label="$item.name + ' ' + $item.application_version"
                           sorton="$item.name"
                           selected-item="platform"
                           createfunction="add_platform($name)"
                           ondelete="delete_platform($item)"
                           onedit="on_edit_platform($item)"
                           selectable="true"
                           editable="false"
                           size="small">
            </list-of-items>
        </div>
    </div>
</div>
<div layout="column" ng-show="platform" class="bg-light">

    <script type="text/ng-template" id="application/search_module.html">
        <div class="modal-header">
            <h3 class="modal-title">Ajouter un module</h3>
        </div>
        <div class="modal-body">
            <form name="searchModuleForm" novalidate
                  ng-submit="searchModuleForm.$valid && $close(moduleSearched)">
                <div class="form-group">
                    <div class="col-lg-12">
                        <input type="text" class="form-control" id="module"
                               ng-model="moduleSearched"
                               placeholder="Rechercher" required
                               data-hint="par nom, version,..."
                               typeahead-editable="false"
                               typeahead="module as module.title for module in find_modules_by_name($viewValue)"
                                />
                    </div>
                </div>
                <input type="submit" value="Submit" ng-hide="true"/>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" ng-disabled="searchModuleForm.$invalid"
                    ng-click="$close(moduleSearched)" ng-hide="isReadOnly">Ok
            </button>
            <button class="btn btn-warning" ng-click="$dismiss('cancel')">Annuler</button>
        </div>
    </script>

    <script type="text/ng-template" id="application/change_platform_version.html">
        <div class="modal-header">
            <h3 class="modal-title">Changer la version de {{platform.platform_name}}</h3>
        </div>
        <div class="modal-body">
            <form name="platformVersionForm" autocomplete="off" novalidate class="form-horizontal"
                  ng-submit="platformVersionForm.$valid && $close({new_version: newVersion, use_ndl: useNdl, copy_properties: copyProperties})">
                <div class="form-group">
                    <div class="col-lg-12">
                        <input type="text" class="form-control" id="version"
                               ng-model="newVersion"
                               placeholder="Nouvelle version" required
                               typeahead="version for version in ndlVersions | filter:$viewValue"
                               typeahead-editable="true"
                               typeahead-min-length="3"/>
                    </div>
                </div>
                <div class="form-group vertical-align" ng-show="newVersion">
                    <label class="col-lg-8 control-label" style="padding-top: 0"
                           ng-style="{'text-decoration': (useNdl ? '' : 'line-through'), 'font-weight' : (useNdl ? 'bold' : 'normal')}">Utiliser la note de livraison json de la version {{newVersion}}</label>

                    <div class="col-lg-4">
                        <div class="togglebutton">
                            <label>
                                <input type="checkbox" id="useNdl" ng-model="useNdl"/>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-group vertical-align" ng-show="useNdl">
                    <label class="col-lg-8 control-label" style="padding-top: 0"
                           ng-style="{'text-decoration': (copyProperties ? '' : 'line-through'), 'font-weight' : (copyProperties ? 'bold' : 'normal')}">Copier les properties valorisées de la version {{platform.application_version}} vers la version {{newVersion}}</label>

                    <div class="col-lg-4">
                        <div class="togglebutton">
                            <label>
                                <input type="checkbox" ng-model="copyProperties"/>
                            </label>
                        </div>
                    </div>
                </div>
                <input type="submit" value="Submit" ng-hide="true"/>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" ng-disabled="platformVersionForm.$invalid"
                    ng-click="$close({new_version: newVersion, use_ndl: useNdl, copy_properties: copyProperties})"
                    ng-hide="isReadOnly">Ok
            </button>
            <button class="btn btn-warning" ng-click="$dismiss('cancel')">Annuler</button>
        </div>
    </script>

    <script type="text/ng-template" id="application/change_module_version.html">
        <div class="modal-header">
            <h3 class="modal-title">Changer la version de {{module.title}}</h3>
        </div>
        <div class="modal-body">
            <form name="searchModuleForm" autocomplete="off" novalidate class="form-horizontal"
                  ng-submit="searchModuleForm.$valid && $close({new_module: moduleSearched, copy_properties: copyProperties})">
                <div class="form-group">
                    <div class="col-lg-12">
                        <input type="text" class="form-control"
                               ng-model="moduleSearched"
                               placeholder="Rechercher la nouvelle version" required
                               data-hint="entrer juste la version, la recherche filtre déjà sur le nom du module"
                               typeahead-editable="false"
                               typeahead="module as module.title for module in find_modules_by_name($viewValue)"
                                />
                    </div>
                </div>
                <div class="form-group vertical-align" ng-show="moduleSearched">
                    <label class="col-lg-8 control-label" style="padding-top: 0"
                           ng-style="{'text-decoration': (copyProperties ? '' : 'line-through'), 'font-weight' : (copyProperties ? 'bold' : 'normal')}">Copier
                        les properties valorisées de la version {{module.version}} vers la version
                        {{moduleSearched.version}}</label>

                    <div class="col-lg-4">
                        <div class="togglebutton">
                            <label>
                                <input type="checkbox" id="copyProperties" ng-model="copyProperties"/>
                            </label>
                        </div>
                    </div>
                </div>
                <input type="submit" value="Submit" ng-hide="true"/>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" ng-disabled="searchModuleForm.$invalid"
                    ng-click="$close({new_module: moduleSearched, copy_properties: copyProperties})"
                    ng-hide="isReadOnly">Ok
            </button>
            <button class="btn btn-warning" ng-click="$dismiss('cancel')">Annuler</button>
        </div>
    </script>

    <script type="text/ng-template" id="application/add_box.html">
        <div class="modal-header">
            <h3 class="modal-title">Ajouter un groupe logique</h3>
        </div>
        <div class="modal-body">
            <form name="addComponentForm" novalidate
                  ng-submit="addComponentForm.$valid && $close(new_component_name)">
                <label for="name">Nom</label>
                <input type="text" class="form-control"
                       ng-model="new_component_name"
                       placeholder="Exemple WDIGST,..." required/>
                <input type="submit" value="Submit" ng-hide="true"/>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" ng-disabled="addComponentForm.$invalid"
                    ng-click="$close(new_component_name)" ng-hide="isReadOnly">Ok
            </button>
            <button class="btn btn-warning" ng-click="$dismiss('cancel')">Annuler</button>
        </div>
    </script>

    <script type="text/ng-template" id="application/add_instance.html">
        <div class="modal-header">
            <h3 class="modal-title">Ajouter une instance</h3>
        </div>
        <div class="modal-body">
            <form name="addInstanceForm" novalidate
                  ng-submit="addInstanceForm.$valid && $close(new_instance_name)">
                <label for="name">Nom</label>
                <input type="text" class="form-control" id="name"
                       ng-model="new_instance_name" required/>
                <input type="submit" id="submit" value="Submit" ng-hide="true"/>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" ng-disabled="addInstanceForm.$invalid"
                    ng-click="$close(new_instance_name)" ng-hide="isReadOnly">Ok
            </button>
            <button class="btn btn-warning" ng-click="$dismiss('cancel')">Annuler</button>
        </div>
    </script>

    <script type="text/ng-template" id="application/properties_diff_wizard.html">
        <div class="jumbotron" style="padding: 20px 20px 20px 20px">
            <wizard>
                <wz-step title="Choisir la plateforme à comparer">
                    <div class="modal-header">
                        <h3 class="modal-title">Choisir la plateforme à laquelle comparer {{platform.application_name}}
                            -
                            {{platform.name}}</h3>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" name="comparedPlatformForm">
                            <fieldset>
                                <div class="form-group">
                                    <br/>
                                    <input type="text" class="form-control"
                                           placeholder="Application à laquelle comparer"
                                           ng-model="from.application" required
                                           data-hint="WDI, PAO, STF, ..."/>
                                    <br/>
                                    <input type="text" class="form-control" placeholder="Plateforme à laquelle comparer"
                                           ng-model="from.platform" required
                                           data-hint="WDI, PAO, STF, ..."/>
                                    <br/>

                                    <div class="togglebutton animate-show"
                                         ng-show="from.application != null && from.platform != null">
                                        <label>Comparer à {{from.application}} - {{from.platform}} à une date spécifique
                                            ?
                                            <input type="checkbox" ng-model="from.lookPast" style="margin-left: 10px"/>
                                        </label>
                                    </div>
                                    <br/>

                                    <div class="dropdown" ng-show="from.lookPast">
                                        <a class="dropdown-toggle" data-toggle="dropdown"
                                           data-target="#"
                                           href="javascipt:void(0)">
                                            <div class="input-group">
                                                <input type="text" class="form-control" data-ng-model="from.date"
                                                       placeholder="Choisir une date"><span
                                                    class="input-group-addon"><i
                                                    class="glyphicon glyphicon-calendar"></i></span>
                                            </div>
                                        </a>
                                        <ul class="dropdown-menu" role="menu">
                                            <datetimepicker data-ng-model="from.date" ng-required="from.lookPast"
                                                            data-datetimepicker-config="{ dropdownSelector: '#dropdownDate', minView: 'hour'}"/>
                                        </ul>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                    <div class="modal-footer">

                        <button class="btn btn-primary btn-raised" wz-next ng-disabled="comparedPlatformForm.$invalid"
                                ng-click="get_platform_to_compare(from.application, from.platform, from.lookPast, from.date)">
                            Suivant
                        </button>
                        <button class="btn btn-warning btn-raised" ng-click="$dismiss('cancel')">Annuler</button>
                    </div>
                </wz-step>
                <wz-step title="Choisir le module à comparer">
                    <div class="modal-header">
                        <h3 class="modal-title">Choisir le module de {{compare_platform.application_name}} -
                            {{compare_platform.name}} à comparer à {{compare_module.title}} sur
                            {{platform.application_name}} - {{platform.name}}</h3>
                    </div>
                    <div class="modal-body">
                        <div layout="row" style="align-items: center" layout-margin>
                            <div flex="66">
                                <ul class="breadcrumb" style="margin-bottom: 2px">
                                    <li>{{platform.application_name}}</li>
                                    <li>{{platform.name}}</li>
                                    <li ng-repeat="token in compare_module.path.substr(1).split('#')">{{token}}</li>
                                    <li class="active">{{compare_module.title}}</a>
                                    </li>
                                </ul>
                                <div layout="row" layout-align="space-around" layout-margin>
                                    <span class="glyphicon glyphicon-resize-vertical"></span>
                                    <span class="glyphicon glyphicon-resize-vertical"></span>
                                    <span class="glyphicon glyphicon-resize-vertical"></span>
                                </div>
                                <ul class="breadcrumb" style="margin-bottom: 2px">
                                    <li>{{compare_platform.application_name}}</li>
                                    <li>{{compare_platform.name}}</li>
                                    <li ng-repeat="token in compare_platform.chosen_module.path.substr(1).split('#')">
                                        {{token}}
                                    </li>
                                    <li class="active">{{compare_platform.chosen_module.title}}</a>
                                    </li>
                                </ul>
                            </div>
                            <div flex style="text-align: end">
                                <button class="btn btn-primary btn-raised" wz-next aria-label="Lancer le diff"
                                        ng-disabled="!compare_platform.chosen_module" ng-click="$close()">
                                    Lancer le diff
                                </button>
                            </div>
                        </div>
                        <div layout="row" layout-margin>
                            <a href="" ng-click="modules_toggle=!modules_toggle">Choisir un autre module de
                                {{compare_platform.application_name}} -
                                {{compare_platform.name}}</a>
                        </div>
                        <div layout="row" layout-sm="column" layout-align="space-around">
                            <md-progress-circular class="md-warn md-hue-3" md-mode="indeterminate"
                                                  ng-show="loading_compare_platform"></md-progress-circular>
                            <div flex ng-hide="loading_compare_platform">
                                <ul class="breadcrumb" style="margin-bottom: 2px" ng-show="modules_toggle"
                                    ng-repeat="module in compare_platform.modules | orderBy:'path'">
                                    <li ng-repeat="token in module.path.split('#')">{{token}}</li>
                                    <li class="active"><a href="" ng-click="compare_platform.chosen_module = module">{{module.title}}</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-warning btn-raised" ng-click="$dismiss('cancel')">Annuler</button>
                    </div>
                </wz-step>
            </wizard>
        </div>
    </script>

    <script type="text/ng-template" id="application/global_properties_diff_wizard.html">
        <div class="jumbotron" style="padding: 20px 20px 20px 20px">
            <wizard>
                <wz-step title="Choisir la plateforme à comparer">
                    <div class="modal-header">
                        <h3 class="modal-title">Choisir la plateforme à laquelle comparer les properties globales de
                            {{platform.application_name}} -
                            {{platform.name}}</h3>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal" name="comparedPlatformForm">
                            <fieldset>
                                <div class="form-group">
                                    <br/>
                                    <input type="text" class="form-control"
                                           placeholder="Application à laquelle comparer"
                                           ng-model="from.application" required
                                           data-hint="WDI, PAO, STF, ..."/>
                                    <br/>
                                    <input type="text" class="form-control" placeholder="Plateforme à laquelle comparer"
                                           ng-model="from.platform" required
                                           data-hint="WDI, PAO, STF, ..."/>
                                    <br/>

                                    <div class="togglebutton animate-show"
                                         ng-show="from.application != null && from.platform != null">
                                        <label>Comparer à {{from.application}} - {{from.platform}} à une date spécifique
                                            ?
                                            <input type="checkbox" ng-model="from.lookPast" style="margin-left: 10px"/>
                                        </label>
                                    </div>
                                    <br/>

                                    <div class="dropdown" ng-show="from.lookPast">
                                        <a class="dropdown-toggle" data-toggle="dropdown"
                                           data-target="#"
                                           href="javascipt:void(0)">
                                            <div class="input-group">
                                                <input type="text" class="form-control" data-ng-model="from.date"
                                                       placeholder="Choisir une date"><span
                                                    class="input-group-addon"><i
                                                    class="glyphicon glyphicon-calendar"></i></span>
                                            </div>
                                        </a>
                                        <ul class="dropdown-menu" role="menu">
                                            <datetimepicker data-ng-model="from.date" ng-required="from.lookPast"
                                                            data-datetimepicker-config="{ dropdownSelector: '#dropdownDate', minView: 'hour'}"/>
                                        </ul>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary btn-raised" wz-next aria-label="Lancer le diff"
                                ng-click="$close(from)">
                            Lancer le diff
                        </button>
                        <button class="btn btn-warning btn-raised" ng-click="$dismiss('cancel')">Annuler</button>
                    </div>
                </wz-step>
            </wizard>
        </div>
    </script>

    <script type="text/ng-template" id="box_renderer.html">
        <div class="vertical-align">
            <div class="col-md-6 text-left" style="padding-left:10px">
                <a href="" editable-text="name" title="Modifier le nom du groupe logique"
                   onbeforesave="update_box_name(box, name, $data)">{{name}}</a>
            </div>
            <div class="col-md-6" style="padding-right:10px; justify-content: flex-end">
                <md-button ng-click="search_module(box)" tooltip="Ajouter un module" aria-label="Ajouter un module"
                           class="md-btn-xs">
                    <span class="glyphicon glyphicon-plus"></span>
                </md-button>
                <md-button ng-click="open_add_box_dialog(box)" tooltip="Ajouter un groupe logique"
                           aria-label="Ajouter un groupe logique"
                           class="md-btn-xs">
                    <span class="glyphicon glyphicon-inbox"></span>
                </md-button>
                <md-button ng-really-message="Supprimer le groupe logique {{name}} ?"
                           tooltip="Supprimer le groupe logique"
                           aria-label="Supprimer le groupe logique"
                           ng-really-click="remove_box(name, box)" ng-if="box.isEmpty()"
                           class="md-btn-xs md-warn">
                    <span class="glyphicon glyphicon-trash"></span>
                </md-button>
            </div>
        </div>
        <ul class="list-inline box">
            <li class="jumbotron" ng-repeat="(name, box) in box.children"
                ng-include="'box_renderer.html'"></li>
            <li ng-if="box.modules.length > 0" class="jumbotron instance" ng-repeat="module in box.modules">
                <div id="header" style="height: 38px; width: 100%" class="col-md-12  vertical-align">
                    <div class="col-md-6" style="padding-left:10px;white-space: nowrap;">
                                <span><strong>{{module.title}}</strong></span>
                    </div>
                    <div class="col-md-6" style="justify-content: flex-end">
                        <md-button ng-click="open_add_instance_dialog(module)" tooltip="Ajouter une instance"
                                   aria-label="Ajouter une instance"
                                   class="md-btn-xs">
                            <span class="glyphicon glyphicon-plus"></span>
                        </md-button>
                        <md-button class="md-btn-xs" tooltip="Editer les properties" aria-label="Editer les properties"
                                   ng-click="edit_properties(platform, module)"><span
                                class="glyphicon glyphicon-list"></span>
                        </md-button>
                        <md-button class="md-btn-xs" tooltip="Comparer les properties"
                                   aria-label="Comparer les properties"
                                   ng-click="diff_properties(module)"><span
                                class="glyphicon glyphicon-transfer"></span>
                        </md-button>
                        <md-button ng-click="open_module_page(module.name, module.version, module.is_working_copy)" tooltip="Afficher le module {{module.title}}"
                                   aria-label="Afficher le module"
                                   class="md-btn-xs">
                            <span class="glyphicon glyphicon-pencil"></span>
                        </md-button>
                        <md-button aria-label="Modifier la version du module"
                                   tooltip="Modifier la version du module"
                                   class="md-btn-xs"
                                   ng-click="change_module(module)">
                            <span class="glyphicon glyphicon-tag"></span>
                        </md-button>
                        <md-button ng-really-message="Supprimer le module {{module.title}} et toutes ses instances ?"
                                   aria-label="Supprimer le module"
                                   tooltip="Supprimer le module"
                                   ng-really-click="delete_module(module, box)"
                                   class="md-btn-xs md-warn">
                            <span class="glyphicon glyphicon-trash"></span>
                        </md-button>
                    </div>
                </div>
                <div>
                    <ul class="list-inline" style="padding-top:10px; padding-bottom:10px;padding-left: 10px;">
                        <li ng-repeat="instance in module.instances | orderBy:'name':false"
                            ng-mouseover="instance.hover = true" ng-mouseleave="instance.hover = false">
                            <md-button ng-click="edit_instance(instance, module.properties_path)"
                                       tooltip="Editer les properties de l'instance"
                                       aria-label="Editer les properties de l'instance"
                                       class="">
                                <span class="glyphicon glyphicon-list" style="margin-right:10px"></span>{{instance.name}}
                            </md-button>
                            <md-button ng-click="preview_instance(box, application, platform, instance, module)"
                                       aria-label= "Prévisualiser l'instance"
                                       tooltip="Prévisualiser l'instance"
                                       class="md-warn" ng-show="instance.hover">
                                <span class="glyphicon glyphicon-eye-open"></span>
                            </md-button>
                            <md-button ng-really-message="Supprimer l'instance {{instance.name}} ?"
                                       aria-label="Supprimer l'instance"
                                       tooltip="Supprimer l'instance"
                                       ng-really-click="delete_instance(instance, module)"
                                       class="md-warn" ng-show="instance.hover">
                                <span class="glyphicon glyphicon-trash"></span>
                            </md-button>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </script>

    <div layout="row" class="vertical-align">
        <div flex="66">
            <h3><span>Representation logique de <strong>{{platform.name}} (version
                <a href="" ng-click="change_platform_version(platform)"
                   title="Modifier la version de la plateforme"
                   class="ng-binding"
                   onaftersave="save_platform_from_box(mainBox)">{{platform.application_version}}</a>
                )</strong></span>
            </h3>
        </div>
        <div flex="33">
            <div layout="row" layout-align="end center">
                <h3 class="togglebutton">
                    <span style="padding-right: 10px">Plateforme de production</span>
                    <label>
                        <input type="checkbox" ng-model="platform.production"
                               ng-change="save_platform_from_box(mainBox)"
                               id="isProduction"/>
                    </label>
                </h3>
            </div>
        </div>
    </div>

    <div layout="row" class="vertical-align">
        <h3><span style="padding-right: 10px">Properties niveau plateforme</span>
            <button class="btn btn-warn btn-raised" ng-click="showGlobalProperties = !showGlobalProperties"><span>Voir/Masquer</span>
            </button>
            <button id="savedPropertiesButton" ng-click="save_global_properties(platform.global_properties)"
                    class="btn btn-primary btn-raised">
                <span class="glyphicon glyphicon-saved" style="padding-right:10px"></span>
                <span>Sauver les properties globales</span>
            </button>
            <button id="diffGlobalPropertiesButton" ng-click="diff_global_properties(platform)"
                    class="btn btn-warn btn-raised">
                <span class="glyphicon glyphicon-transfer" style="padding-right:10px"></span>
                <span>Comparer les properties globales</span>
            </button>
        </h3>
    </div>

    <div layout="row" class="vertical-align" ng-show="showGlobalProperties">
        <div flex="100">
            <form class="form-horizontal narrow" role="form">
                <div class="form-group">
                  <div class="col-md-1">
                    <button id="sortGlobalPropertiesButton" ng-click="platform.global_properties.switchOrder()"
                            class="btn btn-warn btn-raised">
                        <span>Tri par nom de property</span>
                        <span class="glyphicon" data-ng-class="{'glyphicon-sort-by-alphabet-alt': !platform.global_properties.isReverseOrder(), 'glyphicon-sort-by-alphabet': platform.global_properties.isReverseOrder()}" style="padding-left:10px"></span>
                    </button>
                  </div>
                </div>
                <div class="form-group">
                    <div class="col-md-1">
                        <md-button ng-click="platform.global_properties.addKeyValue({
                        'name': new_kv_name,
                        'value': new_kv_value,
                        'comment': ''
                    });new_kv_name = ''; new_kv_value= ''" tooltip="Ajouter" aria-label="Ajouter"
                                   class="md-btn-xs">
                            <span class="glyphicon glyphicon-plus"></span>
                        </md-button>
                    </div>
                    <div class="col-md-4">
                        <input class="form-control" placeholder="Nouvelle property globale" ng-model="new_kv_name" focus-save-global-properties/>
                    </div>
                    <div class="col-md-7">
                        <input class="form-control" placeholder="Valorisation" ng-model="new_kv_value" focus-save-global-properties/>
                    </div>
                </div>
                <div class="form-group" ng-repeat="kv_property in platform.global_properties.key_value_properties | orderBy:'name':platform.global_properties.isReverseOrder() track by $index">
                    <div class="col-md-1">
                        <md-button ng-really-message="Supprimer la property globale {{kv_property.name}} ?"
                                   tooltip="Supprimer"
                                   aria-label="Supprimer"
                                   ng-really-click="platform.global_properties.deleteKeyValue(kv_property)"
                                   class="md-btn-xs md-warn">
                            <span class="glyphicon glyphicon-trash"></span>
                        </md-button>
                    </div>
                    <div class="col-md-4">
                        <label style="text-align: right; overflow: hidden; text-overflow: ellipsis"
                               title="{{ kv_property.name }}" for="input-{{ kv_property.name }}"
                               class="col-md-12 control-label">{{ kv_property.name }}</label>
                    </div>
                    <div class="col-md-7">
                        <input id="input-{{ kv_property.name }}" type="text" class="form-control"
                               ng-model="kv_property.value" focus-save-global-properties/>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!--
    <button ng-click="save_platform_from_box(mainBox, true)" class="btn btn-sm">
        <span class="glyphicon glyphicon-saved" style="padding-right:10px"></span>
        <span>Sauver la plateforme</span>
    </button>
    -->
    <div layout="row" layout-wrap>
        <div flex="5">
            <md-button ng-click="open_add_box_dialog(mainBox)" class="md-fab md-btn-xs"
                       aria-label="Ajouter un groupe logique"
                       style="color: black;background-color: white">
                <span class="glyphicon glyphicon-inbox"></span>
                <md-tooltip>
                    Ajouter un groupe logique
                </md-tooltip>
            </md-button>
        </div>
        <div flex="95">
            <ul class="list-inline box">
                <li class="jumbotron" ng-repeat="(name, box) in mainBox.children" ng-include="'box_renderer.html'"/>
                <li class="jumbotron" ng-if="box.modules.length > 0">
                    <button class="btn btn-info btn-sm" style="margin: 5px 5px 5px 5px"
                            ng-repeat="module in mainBox.modules">{{module.title}} <span
                            class="glyphicon glyphicon-list"></span></button>
                </li>
            </ul>
        </div>
    </div>

    <div layout="row" ng-show="properties">
        <div flex="50">
            <h3><span style="margin-right: 30px">Les properties associees a <strong>{{selected_module.path.split('#').join('
                | ')}} | {{selected_module.title}}</strong></span>
            </h3>
        </div>
        <div flex="50">
            <div id="propertiesButtonsContainer" layout="row" layout-align="space-around" style="z-index: 1000">
                <button id="cleanPropertiesButton" ng-click="clean_properties(properties)"
                        class="btn btn-warn btn-raised" style="z-index: 1000">
                    <span class="glyphicon glyphicon-trash" style="padding-right:10px"></span>
                    <span>Nettoyer les valorisations inutiles</span>
                </button>
                <button ng-click="save_properties(properties, selected_module)"
                        ng-disabled="technoForm.$invalid"
                        class="btn btn-primary btn-raised">
                    <span class="glyphicon glyphicon-saved" style="padding-right:10px"></span>
                    <span>Sauver les properties</span>
                </button>
            </div>
        </div>
    </div>
    <div layout="row" ng-show="properties">
        <div flex="100">
            <properties-list properties="properties">
            </properties-list>
        </div>
    </div>
    <div layout="row" ng-show="instance">
        <div class="col-md-12">
            <h3>
                <span style="margin-right: 30px">Les properties d'instance associees a <strong>
                    <a href="" editable-text="instance.name"
                       onbeforesave="update_instance_name(instance, $data)">{{instance.name}}</a></strong></span>
                <button ng-click="save_platform_from_box(mainBox)"
                        class="btn btn-sm">
                    <span class="glyphicon glyphicon-saved" style="padding-right:10px"></span>
                    <span>Sauver les properties</span>
                </button>
            </h3>

            <div class="col-md-12">
                <toggle-deleted-properties key-value-properties="instance.key_values" toggle="displayDeletedProperties"></toggle-deleted-properties>
                <toggle-unspecified-properties key-value-properties="instance.key_values" display = "displayUnspecified"></toggle-unspecified-properties>
            </div>

            <form class="form-horizontal narrow" role="form" editable-form>
                <div class="form-group">
                  <div class="col-md-1">
                    <button id="sortInstancePropertiesButton" ng-click="instance.switchOrder()"
                            class="btn btn-warn btn-raised">
                        <span>Tri par nom de property</span>
                        <span class="glyphicon" data-ng-class="{'glyphicon-sort-by-alphabet-alt': !instance.isReverseOrder(), 'glyphicon-sort-by-alphabet': instance.isReverseOrder()}" style="padding-left:10px"></span>
                    </button>
                  </div>
                </div>

                <div class="form-group" ng-class="{'property-not-used': !key_value_property.inModel}"
                     ng-repeat="key_value_property in instance.key_values | displayProperties:displayDeletedProperties | displayUnspecifiedProperties:displayUnspecified | hideHesperidesPredefinedProperties | orderBy:'name':instance.isReverseOrder() track by $index">
                    <label for="input-{{ key_value_property.name }}" class="col-md-3 control-label">{{
                        key_value_property.name }} <span ng-show="key_value_property.required" style="color:red"> *</span></label>

                    <div class="col-md-9">
                        <input id="input-{{ key_value_property.name }}" type="text" class="form-control"
                               placeholder="{{key_value_property.defaultValue ? '[default=' + key_value_property.defaultValue + '] ' : ''}}{{key_value_property.comment}}"
                               ng-model="key_value_property.value"
                               tooltip="{{key_value_property.comment}}" tooltip-trigger="focus"
                               ng-required="key_value_property.required"
                               tooltip-placement="right"/>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


